datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model PendingUser {
  id                    Int       @id @default(autoincrement())
  email                 String    @unique
  password              String
  officialName          String
  officialSurname       String
  nationality           String?
  dateOfBirth           DateTime?
  timeCreated           DateTime  @default(now())
  emailVerificationCode String
}

model passwordReset {
  id                Int      @id @default(autoincrement())
  email             String   @unique
  timeCreated       DateTime @default(now())
  passwordResetCode String
}

model Account {
  id          String   @id @default(uuid())
  password    String
  timeCreated DateTime @default(now())
  lastLogin   DateTime
  user        User[]
}

model SecurityCouncilCountry {
  id          String    @id @default(uuid())
  countryCode String
  committee   Committee @relation(fields: [committeeId], references: [id], onDelete: Cascade)
  committeeId String
}

model User {
  id                                  String                                @id @unique
  email                               String                                @unique
  phoneNumber                         String?
  phoneCode                           String?
  profilePicture                      String?
  //
  isDisabled                          Boolean                               @default(false)
  //
  officialName                        String
  officialSurname                     String
  displayName                         String?
  username                            String?                               @unique
  //
  nationality                         String?
  dateOfBirth                         DateTime?                             @map("dob")
  gender                              String?
  //
  bio                                 String?
  pronouns                            String?
  //
  Student                             School?                               @relation(fields: [schoolId], references: [id])
  schoolId                            String?
  //
  isProfilePrivate                    Boolean                               @default(true)
  //ACCOUNT
  account                             Account?                              @relation(fields: [accountId], references: [id])
  accountId                           String?                               @unique
  //
  member                              Member[]
  delegate                            Delegate[]
  schoolDirector                      SchoolDirector[]
  chair                               Chair[]
  manager                             Manager[]
  globalAdmin                         GlobalAdmin[]
  seniorDirecor                       SeniorDirector[]
  secretaryGeneral                    SecretaryGeneral[]
  presidentOfTheGeneralAssembly       PresidentOfTheGeneralAssembly[]
  deputySecretaryGeneral              DeputySecretaryGeneral[]
  admin                               Admin[]
  message                             Message[]
  reaction                            Reaction[]
  chatMemeber                         ChatMemeber[]
  groupChatMemeber                    GroupChatMemeber[]
  deputyPresidentOfTheGeneralAssembly DeputyPresidentOfTheGeneralAssembly[]
  organiser                           Organiser[]
  Director                            Director[]
  SessionResource                     SessionResource[]
  Announcement                        Announcement[]
}

model Session {
  id                                  String                                @id @default(uuid())
  //
  isVisible                           Boolean                               @default(false)
  isCurrent                           Boolean                               @default(false)
  number                              String                                @unique
  numberInteger                       Int                                   @unique
  //
  theme                               String                                @default("")
  phrase2                             String                                @default("")
  //
  description                         String                                @default("")
  welcomeText                         String                                @default("")
  //
  explanation                         String                                @default("")
  //
  committee                           Committee[]
  schoolDirector                      SchoolDirector[]
  Day                                 Day[]
  secretaryGeneral                    SecretaryGeneral[]
  presidentOfTheGeneralAssembly       PresidentOfTheGeneralAssembly[]
  deputySecretaryGeneral              DeputySecretaryGeneral[]
  department                          Department[]
  chat                                Chat[]
  groupChat                           GroupChat[]
  deputyPresidentOfTheGeneralAssembly DeputyPresidentOfTheGeneralAssembly[]
  organiser                           Organiser[]
  SessionResource                     SessionResource[]
  Announcement                        Announcement[]
}

model GlobalAdmin {
  id   String @id @unique
  user User   @relation(fields: [id], references: [id])
}

model Admin {
  id   String @id @unique
  user User   @relation(fields: [id], references: [id])
}

model SeniorDirector {
  id   String @id @unique
  user User   @relation(fields: [id], references: [id])
}

model Director {
  id   String @id @unique
  user User   @relation(fields: [id], references: [id])
}

model SecretaryGeneral {
  id        String  @id @default(uuid())
  session   Session @relation(fields: [sessionId], references: [id])
  sessionId String
  User      User    @relation(fields: [userId], references: [id])
  userId    String

  @@unique([userId, sessionId])
}

model DeputySecretaryGeneral {
  id        String  @id @default(uuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String
  session   Session @relation(fields: [sessionId], references: [id])
  sessionId String

  @@unique([userId, sessionId])
}

model PresidentOfTheGeneralAssembly {
  id        String  @id @default(uuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String
  session   Session @relation(fields: [sessionId], references: [id])
  sessionId String

  @@unique([userId, sessionId])
}

model DeputyPresidentOfTheGeneralAssembly {
  id        String  @id @default(uuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String
  session   Session @relation(fields: [sessionId], references: [id])
  sessionId String

  @@unique([userId, sessionId])
}

model Organiser {
  id        String  @id @default(uuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String
  session   Session @relation(fields: [sessionId], references: [id])
  sessionId String

  @@unique([userId, sessionId])
}

model Day {
  id              String            @id @default(nanoid())
  type            DayType
  name            String?
  description     String?
  date            DateTime?         @unique
  location        Location?         @relation(fields: [locationId], references: [id])
  locationId      String?
  session         Session           @relation(fields: [sessionId], references: [id])
  sessionId       String
  DraftResolution DraftResolution[]
  RollCall        RollCall[]
}

model School {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?
  slug        String?          @unique
  joinYear    Int?
  location    Location?        @relation(fields: [locationId], references: [id])
  locationId  String?
  director    SchoolDirector[]
  User        User[]
}

model SchoolDirector {
  id        Int     @id @default(autoincrement())
  user      User    @relation(fields: [userId], references: [id])
  userId    String
  school    School  @relation(fields: [schoolId], references: [id])
  schoolId  String
  session   Session @relation(fields: [sessionId], references: [id])
  sessionId String

  @@unique([userId, schoolId, sessionId])
}

model Committee {
  id                     String                   @id @unique @default(uuid())
  name                   String
  shortName              String?
  slug                   String?
  description            String?
  type                   CommitteeType
  topic1                 String?
  topic1description      String?
  topic2                 String?
  topic2description      String?
  topic3                 String?
  topic3description      String?
  session                Session                  @relation(fields: [sessionId], references: [id])
  sessionId              String
  delegate               Delegate[]
  chair                  Chair[]
  channel                Channel[]
  SecurityCouncilCountry SecurityCouncilCountry[]
  Announcement           Announcement[]

  @@unique([sessionId, name])
  @@unique([sessionId, shortName])
  @@unique([sessionId, slug])
}

model Delegate {
  id              String            @id @default(uuid())
  country         String?
  user            User              @relation(fields: [userId], references: [id])
  userId          String
  committee       Committee         @relation(fields: [committeeId], references: [id], onDelete: Cascade)
  committeeId     String
  DraftResolution DraftResolution[]

  @@unique([userId, committeeId])
}

model Chair {
  id          Int       @id @default(autoincrement())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  committee   Committee @relation(fields: [committeeId], references: [id], onDelete: Cascade)
  committeeId String

  @@unique([userId, committeeId])
}

model Department {
  id          String          @id @default(uuid())
  name        String
  shortName   String?
  slug        String?
  description String?
  type        DepartmentType?
  session     Session         @relation(fields: [sessionId], references: [id])
  sessionId   String
  member      Member[]
  manager     Manager[]
  channel     Channel[]
}

model Member {
  id             Int        @id @default(autoincrement())
  jobDescription String?
  user           User       @relation(fields: [userId], references: [id])
  userId         String
  department     Department @relation(fields: [departmentId], references: [id])
  departmentId   String

  @@unique([userId, departmentId])
}

model Manager {
  id           Int        @id @default(autoincrement())
  user         User       @relation(fields: [userId], references: [id])
  userId       String
  department   Department @relation(fields: [departmentId], references: [id])
  departmentId String

  @@unique([userId, departmentId])
}

model Location {
  id          String   @id @default(uuid())
  name        String
  slug        String?
  description String?
  street      String?
  city        String?
  state       String?
  zipCode     String?
  country     String?
  phoneNumber String?
  phoneCode   String?
  email       String?
  website     String?
  mapUrl      String?
  school      School[]
  Day         Day[]
}

// CHAT GROUPS ///////////////////////////////////////////////////////////

model Chat {
  id        String        @id @default(uuid())
  name      String?
  message   Message[]
  member    ChatMemeber[]
  Session   Session?      @relation(fields: [sessionId], references: [id])
  sessionId String?
}

model ChatMemeber {
  id     Int    @id @default(autoincrement())
  user   User   @relation(fields: [userId], references: [id])
  userId String
  chat   Chat   @relation(fields: [chatId], references: [id])
  chatId String
}

model GroupChat {
  id        String             @id @default(uuid())
  session   Session            @relation(fields: [sessionId], references: [id])
  sessionId String
  message   Message[]
  member    GroupChatMemeber[]
}

model GroupChatMemeber {
  id     Int       @id @default(autoincrement())
  user   User      @relation(fields: [userId], references: [id])
  userId String
  chat   GroupChat @relation(fields: [chatId], references: [id])
  chatId String
}

model Channel {
  id           String      @id @default(uuid())
  name         String
  description  String
  committee    Committee?  @relation(fields: [committeeId], references: [id])
  committeeId  String?
  department   Department? @relation(fields: [departmentId], references: [id])
  departmentId String?
  message      Message[]
}

model RollCall {
  id    String  @id @default(uuid())
  name  String?
  day   Day     @relation(fields: [dayId], references: [id])
  dayId String
}

// MESSAGE ///////////////////////////////////////////////////////////

model Message {
  id          String     @id @default(uuid())
  //
  content     String
  time        DateTime   @default(now())
  user        User       @relation(fields: [userId], references: [id])
  userId      String
  //
  chat        Chat?      @relation(fields: [chatId], references: [id])
  chatId      String?
  groupChat   GroupChat? @relation(fields: [groupChatId], references: [id])
  groupChatId String?
  replyTo     Message?   @relation("reply", fields: [replyToId], references: [id])
  replyToId   String?
  replies     Message[]  @relation("reply")
  //
  reaction    Reaction[]
  channel     Channel?   @relation(fields: [channelId], references: [id])
  channelId   String?
}

model Reaction {
  id        String       @id @default(uuid())
  //
  type      ReactionType
  //
  user      User         @relation(fields: [userId], references: [id])
  userId    String
  //
  message   Message      @relation(fields: [messageId], references: [id])
  messageId String
}

// ANNOUNCEMENT ///////////////////////////////////////////////////////////

model Announcement {
  id          String              @id @default(cuid())
  isPinned    Boolean             @default(false)
  privacy     AnnouncementPrivacy @default(NORMAL)
  //
  type        AnnouncementType
  //
  title       String
  description String?
  markdown    String?
  //
  time        DateTime            @default(now())
  editTime    DateTime?           @default(now())
  //
  Committee   Committee?          @relation(fields: [committeeId], references: [id])
  committeeId String?
  Session     Session?            @relation(fields: [sessionId], references: [id])
  sessionId   String?
  //
  User        User?               @relation(fields: [userId], references: [id])
  userId      String?
}

// SESSION RESOURCES ///////////////////////////////////////////////////////////

model SessionResource {
  id          String   @id @default(uuid())
  name        String?
  description String?
  uuid        String
  time        DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  session     Session  @relation(fields: [sessionId], references: [id])
  sessionId   String
}

model DraftResolution {
  id          String   @id @default(uuid())
  name        String?
  submitter   Delegate @relation(fields: [submitterId], references: [id])
  submitterId String
  day         Day      @relation(fields: [dayId], references: [id])
  dayId       String
}

// TERMS, CONDITIONS AND PRIVACY ///////////////////////////////////////////////////////////

model Term {
  id      Int    @id @default(autoincrement())
  index   Int    @default(0)
  title   String
  content String
}

model Privacy {
  id      Int    @id @default(autoincrement())
  index   Int    @default(0)
  title   String
  content String
}

// ENUMS ///////////////////////////////////////////////////////////

enum ReactionType {
  LOVE
  LAUGH
  SURPRISED
  SAD
  ANGRY
  LIKE
  DISLIKE
}

enum CommitteeType {
  GENERALASSEMBLY
  SECURITYCOUNCIL
  SPECIALCOMMITTEE
}

enum AnnouncementType {
  GENERAL
  MEDIBOOK
  WEBSITE
  SESSION
  SESSIONUSER
  COMMITTEE
  COMMITTEESESSION
  DEPARTMENT
  DEPARTMENTSESSION
  USER
  CHAIR
  DELEGATE
  MEMBER
  MANAGER
  APPLICANT
}

enum AnnouncementPrivacy {
  ANONYMOUS
  BOARD
  SECRETARIAT
  NORMAL
}

enum DayType {
  CONFERENCE
  WORKSHOP
  EVENT
}

enum DepartmentType {
  IT
  MEDINEWS
  APPROVALPANEL
  SALES
  FOODANDCATERING
  PREP
  ADMINSTAFF
  OTHER
}
