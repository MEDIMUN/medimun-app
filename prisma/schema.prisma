datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model PendingUser {
  id                            String   @id @default(auto()) @map("_id") @db.ObjectId
  //
  email                         String   @unique
  official_name                 String
  official_surname              String
  display_name                  String
  display_surname               String
  password                      String
  date_of_birth                 String
  time_created                  DateTime @default(now())
  role                          Role     @default(User)
  email_verification_token      String
  email_verification_identifier String
}

model User {
  id               String           @id @default(auto()) @map("_id") @db.ObjectId
  //
  created_at       DateTime         @default(now())
  password         String           @map("pw")
  //
  email            String           @unique
  phone_number     String?
  //
  official_name    String
  official_surname String
  display_name     String?
  display_surname  String?
  //
  nationality      String?
  date_of_birth    DateTime         @map("dob")
  pronouns         String?
  //
  TeamMember       Member[]
  Delegate         Delegate[]
  SchoolMember     SchoolMember[]
  SchoolDirector   SchoolDirector[]
  CommitteeChair   Chair[]
  TeamManager      Manager[]
  ProfilePicture   ProfilePicture[]
}

model ProfilePicture {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  //
  user    User   @relation(fields: [userId], references: [id])
  userId  String @map("uid")
  picture String
}

model ConferenceSession {
  id                        String                 @id @default(auto()) @map("_id") @db.ObjectId
  //
  is_current                Boolean                @default(true)
  conference_session_number Int
  year                      Int
  theme                     String
  //
  Committee                 Committee[]
  Delegate                  Delegate[]
  Chair                     Chair[]
  TeamMember                Member[]
  TeamManager               Manager[]
  SchoolDirector            SchoolDirector[]
  SessionWorkshopDay        SessionWorkshopDay[]
  ConferenceDay             SessionConferenceDay[]
}

model SessionConferenceDay {
  id          String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  name        String
  date        DateTime
  description String
  location    String
  //
  session     ConferenceSession @relation(fields: [sessionId], references: [id])
  sessionId   String
}

model SessionWorkshopDay {
  id          String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  name        String
  date        DateTime
  description String
  location    String
  //
  session     ConferenceSession @relation(fields: [sessionId], references: [id])
  sessionId   String
}

model School {
  id             String           @id @default(auto()) @map("_id") @db.ObjectId
  //
  name           String           @unique
  slug           String?          @unique
  join_year      Int?
  //
  Location       Location         @relation(fields: [locationId], references: [id])
  locationId     String           @db.ObjectId
  //
  SchoolMember   SchoolMember[]
  SchoolDirector SchoolDirector[]
}

model SchoolMember {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  //
  user      User   @relation(fields: [user_id], references: [id])
  user_id   String
  school    School @relation(fields: [school_id], references: [id])
  school_id String
}

model SchoolDirector {
  id         String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  user       User              @relation(fields: [user_id], references: [id])
  user_id    String
  school     School            @relation(fields: [school_id], references: [id])
  school_id  String
  session    ConferenceSession @relation(fields: [session_id], references: [id])
  session_id String
}

model Committee {
  id         String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  name       String            @unique
  slug       String            @unique
  //
  session    ConferenceSession @relation(fields: [session_id], references: [id])
  session_id String
  delegate   Delegate[]
  chair      Chair[]
}

model Delegate {
  id          String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  user        User              @relation(fields: [userId], references: [id])
  userId      String
  committee   Committee         @relation(fields: [committeeId], references: [id])
  committeeId String
  session     ConferenceSession @relation(fields: [sessionId], references: [id])
  sessionId   String
}

model Chair {
  id          String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  user        User              @relation(fields: [userId], references: [id])
  userId      String
  committee   Committee         @relation(fields: [committeeId], references: [id])
  committeeId String
  session     ConferenceSession @relation(fields: [sessionId], references: [id])
  sessionId   String
}

model Team {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  //
  name        String    @unique
  slug        String    @unique
  join_year   Int
  team_member Member[]
  TeamManager Manager[]
}

model Member {
  id        String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  role      String?
  user      User              @relation(fields: [userId], references: [id])
  userId    String
  team      Team              @relation(fields: [teamId], references: [id])
  teamId    String
  session   ConferenceSession @relation(fields: [sessionId], references: [id])
  sessionId String
}

model Manager {
  id        String            @id @default(auto()) @map("_id") @db.ObjectId
  //
  user      User              @relation(fields: [userId], references: [id])
  userId    String
  team      Team              @relation(fields: [teamId], references: [id])
  teamId    String
  session   ConferenceSession @relation(fields: [sessionId], references: [id])
  sessionId String
}

model Location {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  //
  name        String
  slug        String?
  description String?
  //
  street      String?
  city        String?
  state       String?
  zip_code    String?
  country     String?
  //
  phone       String?
  email       String?
  website     String?
  //
  map_url     String?
  School      School[]
}

model Terms {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  number Int    @unique @default(1) @map("num")
  text   String
}

enum AlumniRole {
  Delegate
  Chair
  TeamManager
}

enum ConferenceCommitteeRole {
  Chair
  Delegate
}

enum OrganisationCommitteeRole {
  Member
  Manager
}

enum Role {
  User
  Delegate
  Member
  Chair
  Manager
  SchoolDirector
  DSG
  PGA
  SG
  Director
  SeniorDirector
  Admin
  GlobalAdmin
}
